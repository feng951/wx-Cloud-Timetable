<!--profile.wxml-->
<view class="container">
  <!-- 游客提示栏 -->
  <view wx:if="{{!isLoggedIn}}" class="guest-banner" bindtap="showLoginModal">
    <text class="guest-text">👋 游客请登录，享受体验完整功能！</text>
    <text class="guest-arrow">›</text>
  </view>

  <!-- 用户信息卡片 -->
  <view class="user-card">
    <image 
      class="user-avatar" 
      src="{{userInfo.avatarUrl || '/images/avatar.png'}}" 
      mode="aspectFill"
      binderror="onAvatarError"
    ></image>
    <view class="user-info" bindtap="{{isLoggedIn ? '' : 'showLoginModal'}}">
      <text class="user-name">{{userInfo.nickName || '点击登录'}}</text>
      <text class="user-id">{{isLoggedIn ? 'ID: ' + (userId || 'A0000') : '登录后同步课表数据'}}</text>
    </view>
    <view wx:if="{{!isLoggedIn}}" class="login-hint" bindtap="showLoginModal">
      <text class="login-hint-text">去登录 ›</text>
    </view>
  </view>

  <!-- 统计卡片 -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-num">{{timetableCount}}</text>
      <text class="stat-label">我的课表</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-num">{{courseCount}}</text>
      <text class="stat-label">课程总数</text>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-group">
      <view class="menu-item" bindtap="manageTimetables">
        <view class="menu-left">
          <view class="menu-icon">📚</view>
          <text class="menu-text">管理课表</text>
        </view>
        <view class="menu-right">
          <text wx:if="{{!isLoggedIn}}" class="menu-tag">需登录</text>
          <text class="menu-arrow">›</text>
        </view>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-item" bindtap="about">
        <view class="menu-left">
          <view class="menu-icon">ℹ</view>
          <text class="menu-text">关于我们</text>
        </view>
        <text class="menu-arrow">›</text>
      </view>
    </view>
  </view>

  <!-- 退出登录 -->
  <view wx:if="{{isLoggedIn}}" class="logout-section">
    <button class="logout-btn" bindtap="logout">
      <text class="btn-text">退出登录</text>
    </button>
  </view>

  <!-- 登录引导弹窗 -->
  <view wx:if="{{showLoginModal}}" class="login-modal-mask" bindtap="closeLoginModal">
    <view class="login-modal" catchtap="preventClose">
      <view class="modal-close" bindtap="closeLoginModal">×</view>
      
      <view class="modal-header">
        <text class="modal-title">微信登录</text>
        <text class="modal-subtitle">登录后可享受完整功能</text>
      </view>
      
      <view class="modal-actions">
        <button class="login-btn primary" bindtap="login" loading="{{isLoading}}">
          {{isLoading ? '登录中...' : '微信一键登录'}}
        </button>
        <button class="login-btn secondary" bindtap="closeLoginModal">稍后再说</button>
      </view>
      
      <view class="modal-footer">
        <text class="privacy-text">点击"微信一键登录"即表示您同意</text>
        <view class="privacy-links">
          <text class="privacy-link" bindtap="openUserAgreement">《用户协议》</text>
          <text class="privacy-text">和</text>
          <text class="privacy-link" bindtap="openPrivacyPolicy">《隐私政策》</text>
        </view>
      </view>
    </view>
  </view>
</view>
