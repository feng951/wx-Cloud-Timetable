<!--profile.wxml-->
<view class="container">
  <!-- 未登录状态 - 显示提示信息 -->
  <view wx:if="{{!isLoggedIn}}" class="login-section">
    <view class="login-icon">👤</view>
    <text class="login-title">欢迎使用风表</text>
    <text class="login-subtitle">登录后可管理您的课表</text>
    <button 
      class="login-btn" 
      bindtap="showLoginModal"
    >
      <text class="btn-text">微信一键登录</text>
    </button>
    <view class="privacy-hint">
      <text class="privacy-text">点击"微信一键登录"即表示您同意</text>
      <view class="privacy-links">
        <text class="privacy-link" bindtap="openUserAgreement">《用户协议》</text>
        <text class="privacy-text">和</text>
        <text class="privacy-link" bindtap="openPrivacyPolicy">《隐私政策》</text>
      </view>
    </view>
  </view>

  <!-- 已登录状态 -->
  <view wx:if="{{isLoggedIn}}" class="profile-content">
    <!-- 用户信息卡片 -->
    <view class="user-card">
      <image 
        class="user-avatar" 
        src="{{userInfo.avatarUrl || '/images/avatar.png'}}" 
        mode="aspectFill"
        binderror="onAvatarError"
      ></image>
      <view class="user-info">
        <text class="user-name">{{userInfo.nickName || '微信用户'}}</text>
        <text class="user-id">ID: {{userId || 'A0000'}}</text>
      </view>
    </view>

    <!-- 统计卡片 -->
    <view class="stats-card">
      <view class="stat-item">
        <text class="stat-num">{{timetableCount}}</text>
        <text class="stat-label">我的课表</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-num">{{courseCount}}</text>
        <text class="stat-label">课程总数</text>
      </view>
    </view>

    <!-- 功能菜单 -->
    <view class="menu-section">
      <view class="menu-group">
        <view class="menu-item" bindtap="manageTimetables">
          <view class="menu-left">
            <view class="menu-icon">📚</view>
            <text class="menu-text">管理课表</text>
          </view>
          <text class="menu-arrow">›</text>
        </view>
      </view>

      <view class="menu-group">
        <view class="menu-item" bindtap="about">
          <view class="menu-left">
            <view class="menu-icon">ℹ</view>
            <text class="menu-text">关于我们</text>
          </view>
          <text class="menu-arrow">›</text>
        </view>
      </view>
    </view>

    <!-- 退出登录 -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="logout">
        <text class="btn-text">退出登录</text>
      </button>
    </view>
  </view>

  <!-- 登录引导弹窗 -->
  <view wx:if="{{showLoginModal}}" class="login-modal-mask" bindtap="closeLoginModal">
    <view class="login-modal" catchtap="preventClose">
      <view class="modal-close" bindtap="closeLoginModal">×</view>
      
      <view class="modal-header">
        <text class="modal-title">登录</text>
        <text class="modal-subtitle">登录后可管理您的课表</text>
      </view>
      
      <view class="modal-actions">
        <button class="login-btn primary" bindtap="login" loading="{{isLoading}}">
          {{isLoading ? '登录中...' : '微信一键登录'}}
        </button>
        <button class="login-btn secondary" bindtap="closeLoginModal">稍后再说</button>
      </view>
      
      <view class="modal-footer">
        <text class="privacy-text">点击"微信一键登录"即表示您同意</text>
        <view class="privacy-links">
          <text class="privacy-link" bindtap="openUserAgreement">《用户协议》</text>
          <text class="privacy-text">和</text>
          <text class="privacy-link" bindtap="openPrivacyPolicy">《隐私政策》</text>
        </view>
      </view>
    </view>
  </view>
</view>
