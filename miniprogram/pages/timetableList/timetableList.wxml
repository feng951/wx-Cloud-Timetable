<!--timetableList.wxml-->
<view class="container">
  <view class="header">
    <text class="title">我的课表</text>
    <view class="header-actions">
      <text class="import-btn" bindtap="showImportDialog">导入</text>
      <text class="add-btn" bindtap="addTimetable">+ 新建</text>
    </view>
  </view>

  <view class="list">
    <view wx:for="{{timetables}}" wx:key="id" class="timetable-item">
      <view class="item-content" bindtap="selectTimetable" data-id="{{item.id}}">
        <view class="item-left">
          <text class="item-name">{{item.name}}</text>
          <text wx:if="{{item.isMain}}" class="main-tag">主课表</text>
          <text wx:if="{{item.isDefault}}" class="default-tag">默认</text>
        </view>
        <text class="item-arrow">›</text>
      </view>
      <view class="item-actions">
        <text class="action-text" bindtap="setMainTimetable" data-id="{{item.id}}" wx:if="{{!item.isMain}}">设为主课表</text>
        <text class="action-text" bindtap="openSettings" data-id="{{item.id}}">课表设置</text>
        <text class="action-text share" bindtap="shareTimetable" data-id="{{item.id}}">分享课码</text>
        <text class="action-text delete" bindtap="deleteTimetable" data-id="{{item.id}}" wx:if="{{!item.isMain}}">删除</text>
      </view>
    </view>
  </view>

  <view class="tip">
    <text class="tip-text">主课表将显示在首页，默认课表用于新课表模板</text>
  </view>

  <!-- 分享码弹窗 -->
  <view wx:if="{{showShareModal}}" class="modal-mask" bindtap="hideShareModal">
    <view class="modal-content" catchtap="preventHide">
      <view class="modal-header">
        <text class="modal-title">分享课码</text>
        <text class="modal-close" bindtap="hideShareModal">×</text>
      </view>
      <view class="modal-body">
        <view wx:if="{{shareCode}}" class="share-result">
          <text class="share-label">课程分享码</text>
          <view class="share-code-box">
            <text class="share-code">{{shareCode}}</text>
            <view class="copy-btn" bindtap="copyShareCode">
              <text class="copy-text">复制</text>
            </view>
          </view>
          <text class="share-tip">有效期1小时，请及时分享</text>
        </view>
        <view wx:else class="share-loading">
          <text class="loading-text">生成中...</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 导入弹窗 -->
  <view wx:if="{{showImportModal}}" class="modal-mask" bindtap="hideImportModal">
    <view class="modal-content" catchtap="preventHide">
      <view class="modal-header">
        <text class="modal-title">导入课表</text>
        <text class="modal-close" bindtap="hideImportModal">×</text>
      </view>
      <view class="modal-body">
        <text class="import-label">请输入10位课程分享码</text>
        <input class="import-input" 
               placeholder="例如：ABC123DEF4" 
               maxlength="10"
               value="{{importCode}}"
               bindinput="onImportInput"/>
        <view class="import-actions">
          <text class="import-cancel" bindtap="hideImportModal">取消</text>
          <text class="import-confirm {{importCode.length === 10 ? 'active' : ''}}" bindtap="confirmImport">导入</text>
        </view>
      </view>
    </view>
  </view>
</view>
